<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log Water | FitTrack</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
<div class="page-container">
    <h2>Log Your Water Intake</h2>

    <form id="water-form">
        <label for="water">Amount (ml)</label>
        <input type="number" id="water" required placeholder="e.g. 250 ml">

        <button type="submit">Save Water Intake</button>
    </form>

    <div class="history-box">
        <h3>Water Intake History</h3>
        <div id="water-history"></div>
    </div>

    <div class="nav-links">
        <div class="nav-btn" onclick="window.location.href='dashboard.html'">← Back to Dashboard</div>
        <div class="nav-btn" onclick="window.location.href='meal.html'">← Log Meal</div>
    </div>
    <script>
        document.getElementById("water-form").addEventListener("submit", function (e) {
          e.preventDefault();

          const waterAmount = parseInt(document.getElementById("water").value);

          if (isNaN(waterAmount) || waterAmount <= 0) {
            alert("Please enter a valid amount.");
            return;
          }

          // Update total water intake in localStorage
          let waterTotal = parseInt(localStorage.getItem("waterTotal")) || 0;
          waterTotal += waterAmount;
          localStorage.setItem("waterTotal", waterTotal);

          // Save water log in localStorage
          const waterLogs = JSON.parse(localStorage.getItem("waterLogs")) || [];
          waterLogs.push({
            amount: waterAmount,
            date: new Date().toLocaleString()
          });
          localStorage.setItem("waterLogs", JSON.stringify(waterLogs));

          alert("Water intake saved!");
          location.reload();
        });

        window.onload = function () {
          const historyBox = document.getElementById("water-history");
          const waterLogs = JSON.parse(localStorage.getItem("waterLogs")) || [];

          if (waterLogs.length > 0) {
            waterLogs.slice().reverse().forEach((log, index) => {
              const div = document.createElement("div");
              div.className = "history-entry";
              div.innerHTML = `
                <strong>${log.amount} ml</strong><br>
                <small>${log.date}</small>
                <br><button class="delete-btn" onclick="deleteWater(${waterLogs.length - 1 - index})">Delete</button>
              `;
              historyBox.appendChild(div);
            });
          } else {
            historyBox.innerHTML = "<p>No water intake recorded yet.</p>";
          }
        };

        function deleteWater(index) {
          const waterLogs = JSON.parse(localStorage.getItem("waterLogs")) || [];
          const removed = waterLogs.splice(index, 1)[0];
          localStorage.setItem("waterLogs", JSON.stringify(waterLogs));

          let waterTotal = parseInt(localStorage.getItem("waterTotal")) || 0;
          waterTotal -= removed.amount;
          localStorage.setItem("waterTotal", waterTotal);

          location.reload();
        }
    </script>
</div>
</body>
</html>
